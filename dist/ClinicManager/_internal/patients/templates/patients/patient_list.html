{% extends "base.html" %}

{% block title %}Lista de Pacientes{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Pacientes</h1>
        <a href="{% url 'patients:patient_create' %}" class="btn btn-primary">
            <i class="fas fa-user-plus"></i> Novo Paciente
        </a>
    </div>

    <!-- Filtros e Busca -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" class="row g-3 align-items-center">
                <div class="col-md-6">
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                        <input type="text" name="q" class="form-control" placeholder="Buscar por nome do paciente ou responsável..." value="{{ active_filter_q }}">
                    </div>
                </div>
                <div class="col-md-4">
                    <select name="grupo" class="form-select">
                        <option value="">Todos os Grupos</option>
                        {% for grupo in grupos %}
                        <option value="{{ grupo.pk }}" {% if active_filter_grupo == grupo.pk|stringformat:"s" %}selected{% endif %}>
                            {{ grupo.nome }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-outline-primary w-100">Filtrar</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <ul class="list-group list-group-flush">
                {% for paciente in pacientes %}
                    <a href="{% url 'patients:patient_detail' paciente.pk %}" class="list-group-item list-group-item-action">
                        <strong>{{ paciente.nome_paciente }}</strong> ({{ paciente.idade }} anos)
                        <br>
                        <small class="text-muted">
                            Grupo: {{ paciente.grupo.nome|default:"-" }} | Responsável: {{ paciente.nome_responsavel }}
                        </small>
                    </a>
                {% empty %}
                    <li class="list-group-item">Nenhum paciente encontrado com os filtros aplicados.</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}